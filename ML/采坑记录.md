# 采坑记录

记录格式：

### 标题可以是问题类型或出错的模块
> 22/03/26（记录时间）

```
报错信息
```

排查：可能需要的排查流程

原因：分析问题原因

解决方案：

- 写明解决的步骤 1
- 步骤 2
- 。。。

参考资料：

### RuntimeError: CUDA error: device-side assert triggered
> 23/11/09

https://stackoverflow.com/a/51701698/17347885

- 先按照提示 `export CUDA_LAUNCH_BLOCKING=1`，这样就能定位到准确的报错位置（否则，根据提示，stack trace 可能是错误的）（此时报错没有变化，仅 stack trace 变化）
- 然后根据正确的 stack trace，将报错行（所有相关 `Tensor` `Module`）移到 CPU（`.to('cpu')`），就能看到更加详细的报错，而不是 `device-side assert`

### libstdc++.so.6: version 'GLIBCXX_3.4.26' not found
> 23/03/19

scipy 报错，重装不起作用，降版本不起作用

执行改命令，发现对应版本不存在
```bash
strings /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep GLIBCXX
```

 [github 上的解决方案可行](https://github.com/lhelontra/tensorflow-on-arm/issues/13#issuecomment-489296444) （升级），直接升级不行，需要先添加ppa（可能是ubuntu18版本太低了）

```bash
sudo add-apt-repository ppa:ubuntu-toolchain-r/test
sudo apt-get install --only-upgrade libstdc++6
```

### CondaVerificationError
> 23/03/16

```
CondaVerificationError: The package for _openmp_mutex located at /home/jiewang/.conda/pkgs/_openmp_mutex-5.1-1_gnu appears to be corrupted. The path 'lib/libgomp.so.1' specified in the package manifest cannot be found.
```

 [jupyter - Conda Verification Failed - Data Science Stack Exchange](https://datascience.stackexchange.com/questions/41732/conda-verification-failed)

remove 再 install 之后恢复正常

### 显存不足
> 22/03/26

```
RuntimeError: CUDA out of memory.Tried to allocate 20.00 MiB
```

排查： `nvidia-smi` 查看显卡状况

解决方案：

- 将 batchsize 改小一些
- 根据显卡状况，更换 GPU id

### nn.DataParallel BUG
> 22/03/26

```
StopIteration: Caught StopIteration in replica 0 on device 0.
```

原因：pytorch 单机多卡用 nn.DataParallel 的时候无法 forward，会报错。pytorch1.5 的 bug

解决方案：

- 不用 nn.DataParallel
- 或者降级到 `pytorch==1.4`

参考： https://blog.csdn.net/sunflower_sara/article/details/109674853

# 一些灵异事件

> 影响不大但是很奇怪的事情

### torch.Tensor.sum() undocumented keyword `keepdims`
> 23/01/31

 [pytorch 文档](https://pytorch.org/docs/stable/generated/torch.Tensor.sum.html#torch.Tensor.sum) 中的 keyword argument 是 `keepdim` 但是 `keepdims` 竟然也可以（可能是历史原因？）

不过 [numpy 文档](https://numpy.org/doc/stable/reference/generated/numpy.sum.html) 里是 `keepdims` ，也有可能是把未知 `kwargs` 向 numpy 透传了
